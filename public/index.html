<!DOCTYPE html>
<html>
<head>
  <title>AD Location Spoofer</title>
  <meta charset="utf-8">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',monospace;background:#000;color:#0f0;padding:2rem;max-width:1000px;margin:auto}
    button{padding:15px 30px;margin:10px;background:#0f0;color:#000;border:none;border-radius:8px;cursor:pointer;font-size:16px;font-weight:bold;font-family:monospace;transition:all .2s}
    button:hover{background:#0a0;transform:scale(1.05)}
    button:active{background:#0d0}
    #result{background:#111;padding:25px;margin:25px 0;border-radius:10px;white-space:pre-wrap;font-family:monospace;font-size:14px;max-height:500px;overflow:auto;border:1px solid #333}
    .ip{background:#0f0;color:#000;padding:12px 20px;border-radius:25px;display:inline-block;font-weight:bold;font-size:18px;margin:8px}
    h1{font-size:3em;text-align:center;margin-bottom:20px;text-shadow:0 0 20px #0f0}
    .status{display:inline-block;padding:12px 24px;background:#0f0;color:#000;border-radius:25px;font-weight:bold;font-size:18px;margin-bottom:20px}
    input{width:100%;padding:15px;margin:15px 0;border:2px solid #0f0;background:#111;color:#0f0;font-family:monospace;font-size:16px;border-radius:8px}
    input:focus{outline:none;border-color:#0a0;box-shadow:0 0 10px #0f0}
    select{padding:15px;margin:10px;background:#111;color:#0f0;border:2px solid #0f0;border-radius:8px;font-size:16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:30px 0}
    .loading{text-align:center;font-size:20px;padding:40px;background:linear-gradient(90deg,#111,#000,#111)}
  </style>
</head>
<body>
  <h1>ğŸ›¡ï¸ AD Location Spoofer</h1>
  <div style="text-align:center">
    <div class="status" id="status">ğŸ”„ Testing...</div>
  </div>

  <div class="grid">
    <button onclick="testNY()">ğŸ‡ºğŸ‡¸ New York</button>
    <button onclick="testUK()">ğŸ‡¬ğŸ‡§ London</button>
    <button onclick="testStatus()">ğŸ“Š Status</button>
    <button onclick="testLeak()">ğŸ” IP Leak Test</button>
  </div>
  
  <h3>ğŸ”§ Custom Test</h3>
  <input id="urlInput" value="https://ipinfo.io/json" placeholder="Enter any URL">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
    <select id="locSelect">
      <option value="newyork">ğŸ‡ºğŸ‡¸ New York</option>
      <option value="london">ğŸ‡¬ğŸ‡§ London</option>
    </select>
    <button onclick="testCustom()">ğŸš€ PROXY NOW</button>
  </div>

  <div id="result" class="loading">Click any button above â¬†ï¸</div>

  <script>
    const API_BASE = location.origin;
    let isLoading = false;

    async function fetchProxy(url, location = 'newyork') {
      const encodedUrl = encodeURIComponent(url);
      const proxyUrl = `${API_BASE}/api/proxy?url=${encodedUrl}&location=${location}`;
      
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 10000);
      
      try {
        const res = await fetch(proxyUrl, { signal: controller.signal });
        clearTimeout(timeout);
        return await res.text();
      } catch(e) {
        clearTimeout(timeout);
        throw new Error(`Proxy failed: ${e.message}`);
      }
    }

    async function testNY() {
      await runTest('https://ipinfo.io/json', 'newyork');
    }

    async function testUK() {
      await runTest('https://ipinfo.io/json', 'london');
    }

    async function testStatus() {
      await runTest(`${API_BASE}/api/test`, 'status');
    }

    async function testLeak() {
      await runTest('https://httpbin.org/ip', document.getElementById('locSelect').value);
    }

    async function testCustom() {
      const url = document.getElementById('urlInput').value.trim();
      if(!url) return alert('Enter a URL');
      const loc = document.getElementById('locSelect').value;
      await runTest(url, loc);
    }

    async function runTest(url, location) {
      if(isLoading) return;
      isLoading = true;
      
      try {
        showLoading(`â³ ${location.toUpperCase()} â†’ ${url}`);
        
        const result = await fetchProxy(url, location);
        document.getElementById('result').textContent = result;
        
        // Highlight IP if JSON
        if(result.includes('"ip":')) {
          const ipMatch = result.match(/"ip":\s*"(\d+\.\d+\.\d+\.\d+)"/);
          if(ipMatch) {
            const ip = ipMatch[1];
            document.getElementById('result').innerHTML = 
              result.replace(ip, `<span class="ip">${ip}</span>`);
          }
        }
        
      } catch(error) {
        document.getElementById('result').textContent = `âŒ ERROR: ${error.message}`;
      } finally {
        isLoading = false;
      }
    }

    function showLoading(msg) {
      document.getElementById('status').textContent = 'ğŸŸ¡ LOADING';
      document.getElementById('status').style.background = '#ff0';
      document.getElementById('result').textContent = msg;
    }

    // Auto test on load
    window.onload = async () => {
      await new Promise(r => setTimeout(r, 500));
      await testStatus();
    };
  </script>
</body>
</html>
